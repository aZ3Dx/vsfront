---
import IconArrowBarLeft from '@/assets/icons/IconArrowBarLeft.svg';
import IconMenu2 from '@/assets/icons/IconMenu2.svg';
import IconTriangleFilled from '@/assets/icons/IconTriangleFilled.svg';
import LogoFull from '@/assets/images/LogoFullRounded.png';
import LogoMin from '@/assets/images/LogoMinRounded.png';
import { SERVICES } from '@/consts/services';
import { Image } from 'astro:assets';

const isLanding = Astro.url.pathname === '/';
---

<header class="fixed z-20 flex h-18 w-full items-center">
  <div
    class=`header relative box-content flex w-full items-center justify-center border-b border-transparent py-3 transition-all duration-300
    ${isLanding ? 'text-white' : 'text-midnight'}`
  >
    <div class="menu-button absolute left-4">
      <IconMenu2 stroke-width={2} class="text-inherit" />
    </div>
    <div>
      <a href="/">
        <Image src={LogoMin} class="h-12 w-12" width={100} height={100} alt="Logo" />
      </a>
    </div>
    <a href="/" class="inline-block pl-2 font-heading text-xl font-semibold text-inherit">
      Visual Studio
    </a>
  </div>
  <!-- Menu Mobile -->
  <nav class="menu-mobile fixed top-0 left-0 hidden h-lvh w-3/4 bg-beige1">
    <IconArrowBarLeft class="close-menu-mobile absolute top-4 left-4" />
    <ul
      class="links-container flex h-full flex-col items-center justify-center gap-2 px-10 tracking-wider uppercase"
    >
      <li><a href="/">Inicio</a></li>
      <li class="services-link flex items-center gap-1">
        <span>Servicios</span>
        <IconTriangleFilled class="mt-[2px] h-2 w-2 rotate-180" />
      </li>
      <ul class="submenu-services hidden list-disc overflow-hidden pl-4">
        {
          SERVICES.map((service) => (
            <li class="capitalize">
              <a href={`/servicios/${service.slug}`}>{service.name}</a>
            </li>
          ))
        }
      </ul>
      <li><a href="/portafolio">Portafolio</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="/sobre-nosotros">Sobre Nosotros</a></li>
      <li><a href="/contactanos">Cont√°ctanos</a></li>
    </ul>
    <div class="absolute bottom-4 left-1/2 -translate-x-1/2 transform">
      <Image src={LogoFull} width={70} height={70} alt="Logo" />
    </div>
    <div class="close-area absolute top-0 right-0 h-full w-1/3 translate-x-full bg-midnight/70">
    </div>
  </nav>
</header>

<script>
  import { gsap } from 'gsap';

  const $menuButton = document.querySelector('.menu-button') as HTMLButtonElement;
  const $menuMobile = document.querySelector('.menu-mobile') as HTMLDivElement;
  const $closeMenuButton = document.querySelector('.close-menu-mobile') as HTMLDivElement;
  const $closeArea = document.querySelector('.close-area') as HTMLDivElement;
  const $header = document.querySelector('.header') as HTMLElement;
  const $linksContainer = document.querySelector('.links-container') as HTMLUListElement;

  const $servicesLink = document.querySelector('.services-link') as HTMLLIElement;
  const $submenuServices = document.querySelector('.submenu-services') as HTMLDivElement;

  $servicesLink.addEventListener('click', () => {
    const isHidden = $submenuServices.classList.contains('hidden');

    if (isHidden) {
      $submenuServices.classList.remove('hidden');
      $servicesLink.querySelector('svg')?.classList.remove('rotate-180');

      gsap.fromTo(
        $submenuServices,
        { height: 0, opacity: 0 },
        {
          height: 'auto',
          opacity: 1,
          duration: 0.5,
          ease: 'power2.out',
        },
      );
    } else {
      $servicesLink.querySelector('svg')?.classList.add('rotate-180');
      gsap.to($submenuServices, {
        height: 0,
        opacity: 0,
        duration: 0.4,
        ease: 'power2.in',
        onComplete: () => {
          $submenuServices.classList.add('hidden');
        },
      });
    }
  });

  $menuButton.addEventListener('click', () => {
    $menuMobile.classList.remove('hidden');

    const tl = gsap.timeline();

    tl.fromTo($menuMobile, { x: '-100%' }, { x: '0%', duration: 0.4, ease: 'power3.out' });

    tl.fromTo(
      $linksContainer.querySelectorAll(':scope > li'),
      { x: -20, opacity: 0 },
      {
        x: 0,
        opacity: 1,
        duration: 0.4,
        ease: 'power2.out',
        stagger: 0.1,
      },
      '-=0.1',
    );
  });

  function closeMenu() {
    gsap.to($menuMobile, {
      x: '-100%',
      duration: 0.4,
      ease: 'power3.in',
      onComplete: () => {
        $menuMobile.classList.add('hidden');
        gsap.set($linksContainer.querySelectorAll(':scope > li'), { opacity: 0 });
      },
    });
  }

  [$closeMenuButton, $closeArea].forEach((el) => {
    el.addEventListener('click', closeMenu);
  });

  function checkHeaderScroll() {
    if (window.scrollY > 50) {
      $header.classList.add('header-scrolled');
    } else {
      $header.classList.remove('header-scrolled');
    }
  }

  checkHeaderScroll();
  window.addEventListener('scroll', checkHeaderScroll);
</script>
