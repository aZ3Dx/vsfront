---
import Button from '@/components/Button.astro';
import { SITE_CONFIG } from '@/consts/siteConfig';
import Layout from '@/layouts/Layout.astro';
import { getCollection, getEntry } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blogs');
  return posts.map((post) => ({
    params: { slug: post.slug },
  }));
}

const { slug } = Astro.params;
const post = await getEntry('blogs', slug as string);

if (!post) {
  throw new Error(`No se encontr√≥ el blog con slug ${slug}`);
}

const { Content } = await post.render();

const blogPostingSchema = {
  '@context': 'https://schema.org',
  '@type': 'BlogPosting',
  headline: post.data.title,
  description: post.data.description,
  image: post.data.coverImageUrl,
  datePublished: post.data.createdAt,
  author: {
    '@type': 'Person',
    name: post.data.madeBy,
  },
  publisher: {
    '@type': 'Organization',
    name: SITE_CONFIG.name,
    url: SITE_CONFIG.url,
  },
};

const breadcrumbSchema = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: [
    { '@type': 'ListItem', position: 1, name: 'Inicio', item: SITE_CONFIG.url },
    { '@type': 'ListItem', position: 2, name: 'Blog', item: `${SITE_CONFIG.url}/blog` },
    { '@type': 'ListItem', position: 3, name: post.data.title, item: `${SITE_CONFIG.url}/blogs/${slug}` },
  ],
};
---

<Layout
  title={post.data.title}
  description={post.data.description}
  image={post.data.coverImageUrl}
  type="article"
  article={{ publishedTime: post.data.createdAt, author: post.data.madeBy }}
  jsonLd={[blogPostingSchema, breadcrumbSchema]}
>
  <main class="pt-20">
    <section class="section relative">
      <div class="absolute h-10 w-full bg-linear-to-b from-white to-transparent"></div>
      <div class="px-2 py-4">
        <div class="mb-4">
          <h1 class="text-2xl font-semibold">{post.data.title}</h1>
          <p>
            Por <span class="font-semibold">{post.data.madeBy}</span> | {post.data.lectureTime} de lectura
          </p>
        </div>
        <div class="h-50 overflow-hidden rounded-lg">
          <img
            class="h-full w-full object-cover"
            src={post.data.coverImageUrl}
            alt={`${post.data.title} cover image`}
          />
        </div>
      </div>
    </section>
    <section class="px-2">
      <Content />
    </section>
    <section class="flex justify-center py-10">
      <Button href="/blog" type="anchor" text="Volver al Blog" class="w-fit" />
    </section>
  </main>
</Layout>

<style scoped>
  .section {
    background-image: url("data:image/svg+xml,<svg id='patternId' width='100%' height='100%' xmlns='http://www.w3.org/2000/svg'><defs><pattern id='a' patternUnits='userSpaceOnUse' width='40' height='20' patternTransform='scale(2) rotate(0)'><rect x='0' y='0' width='100%' height='100%' fill='%23ffffffff'/><path d='M19.988 0l10 10L40 .006z'  stroke-width='1' stroke='none' fill='%23faeee0ff'/><path d='M10.012 10L0 19.994 19.988 20z'  stroke-width='1' stroke='none' fill='%23faeee0ff'/></pattern></defs><rect width='800%' height='800%' transform='translate(0,0)' fill='url(%23a)'/></svg>");
  }
</style>
